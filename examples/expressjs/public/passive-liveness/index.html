<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Passive Liveness</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <a href="/" id="back">
      <button>Back</button>
    </a>
    <div id="webcam-wrapper">
      <glair-webcam mirrored width="300" height="300"></glair-webcam>
      <div id="instruction">
        <p style="font-weight: bold">Take photo</p>
        <button id="sshot-btn"></button>
        <p>Make sure your face is clearly visible on the marked area</p>
      </div>
    </div>
  </body>

  <script
    type="module"
    src="https://unpkg.com/@glair/web-components/standalone/webcam.js"
  ></script>

  <script>
    const glairWebcam = document.querySelector("glair-webcam");
    const btn = document.querySelector("#sshot-btn");

    btn.addEventListener("click", async () => {
      const base64sshot = await glairWebcam.screenshot();
      const fetchSshot = await fetch(base64sshot);
      const blob = await fetchSshot.blob();

      const formdata = new FormData();
      formdata.append("image", blob);

      // console.log(base64sshot, blob);

      const response = await fetch("/pl", {
        method: "POST",
        body: formdata,
        redirect: "follow",
      });
      const data = await response.json();
      console.log(data);
    });
  </script>
</html>
